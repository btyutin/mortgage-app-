import * as React from 'react';
import {Box, Flex, Grid, Stack, Tag, TagLabel, Text} from "@chakra-ui/react";
import {IMortgageAgreement, MortgageAgreements} from "../services/MortgageAgreements";
import {observer} from "mobx-react";
import {useService} from "../core/decorators/service";

const MAP_TEXT = {
    NEW: 'Новый',
    WAIT_FOR_PAYMENT: 'Ожидает оплаты'
}



export const ContractCard = observer((props: { onClick: () => void } & IMortgageAgreement) => {
    const handleClick = () => {
        props.onClick();
    }

    const mortgages = useService(MortgageAgreements)

    const polices = mortgages.polices.filter((p) => {
        return p.insuranceAgreement.mortgageDocument.documentNumber === props.documentNumber
    })

    const uniqueRisks = new Set(polices.map(p => p.insuranceAgreement.risk))

    return (
        <Box bg={'white'} padding={'24px'} cursor={'pointer'} borderRadius={'4px'} onClick={() => handleClick()}>
            <Grid templateColumns={'1.5fr 1fr 1fr 1fr'} columnGap={'30px'}>
                <Stack>
                    <Text fontWeight={600} fontSie={18}>№ {props.documentNumber}</Text>
                    <Text fontSize={14} opacity={.8}>12.02.2021 – 12.02.2054</Text>
                </Stack>

                <Stack>
                    <Text fontSize={14} opacity={.8}>Остаток по ипотеке</Text>
                    <Text>{props.remainingAmount} ₽</Text>
                </Stack>

                <Stack>
                    <Text fontSize={14} opacity={.8}>Типы страхований</Text>

                    <InsuranceTypes risks={[...uniqueRisks]}/>
                </Stack>

                <Stack align={'flex-end'} justifyContent={'center'}>
                    <Tag variant={'new'}>
                        <TagLabel width={'100%'} textAlign={'center'}>{MAP_TEXT[props.status]}</TagLabel>
                    </Tag>
                </Stack>
            </Grid>
        </Box>
    )
})

function InsuranceTypes({risks}: { risks: string[] }) {
    return (
        <Flex justifyContent={'flex-start'}>
            <Box color={risks.includes('PROPERTY') ? 'green' : 'lightGrey'}>
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M0.780506 9.95391C0.950386 10.0378 1.15307 10.0184 1.30401 9.90391L2.00401 9.37891V16.5039C2.00401 17.0562 2.45172 17.5039 3.00401 17.5039H15.004C15.5563 17.5039 16.004 17.0562 16.004 16.5039V9.37891L16.704 9.90391C16.8555 10.0175 17.0582 10.0358 17.2276 9.95112C17.397 9.86642 17.504 9.69329 17.504 9.50391V7.00391C17.504 6.84653 17.4299 6.69833 17.304 6.60391L9.30401 0.603906C9.12623 0.470573 8.88178 0.470573 8.70401 0.603906L5.00401 3.37891V2.50391C5.00401 1.95162 4.55629 1.50391 4.00401 1.50391H3.00401C2.45172 1.50391 2.00401 1.95162 2.00401 2.50391V5.62891L0.704005 6.60391C0.578102 6.69833 0.504005 6.84653 0.504005 7.00391V9.50391C0.502966 9.69432 0.610171 9.86879 0.780506 9.95391ZM7.00401 16.5039V12.5039C7.00401 11.3993 7.89944 10.5039 9.00401 10.5039C10.1086 10.5039 11.004 11.3993 11.004 12.5039V16.5039H7.00401ZM15.004 16.5039H12.004V12.5039C12.004 10.8471 10.6609 9.50391 9.00401 9.50391C7.34715 9.50391 6.00401 10.8471 6.00401 12.5039V16.5039H3.00401V8.62891L9.00401 4.12891L15.004 8.62891V16.5039ZM3.00401 2.50391H4.00401V4.12891L3.00401 4.87891V2.50391ZM1.50401 7.25391L9.00401 1.62891L16.504 7.25391V8.50391L9.30401 3.10391C9.12623 2.97057 8.88178 2.97057 8.70401 3.10391L1.50401 8.50391V7.25391Z"
                        fill="currentColor"/>
                </svg>
            </Box>


            <Flex width={'10px'} height={'100%'}/>

            <Box color={risks.includes('LIFE') ? 'green' : 'lightGrey'}>
                <svg width="24" height="18" viewBox="0 0 24 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M16.583 0.500102C14.7772 0.489187 13.0785 1.35572 12.0272 2.82407C10.976 1.35572 9.27727 0.489187 7.47144 0.500102C4.19138 0.500102 2.15375 2.57888 2.15375 5.92558C2.14516 6.74091 2.28455 7.55103 2.56514 8.31661H0.508166C0.280959 8.31661 0.0967712 8.50079 0.0967712 8.728C0.0967712 8.95521 0.280959 9.1394 0.508166 9.1394H2.94198C3.53588 10.1108 4.29266 10.9727 5.17914 11.6872C5.38978 11.8748 5.59424 12.0574 5.78554 12.2397C7.18428 13.573 11.5821 17.1254 11.7689 17.276C11.9196 17.3976 12.1348 17.3976 12.2856 17.276C12.4724 17.1254 16.8706 13.5734 18.2689 12.2397C18.4602 12.0574 18.6647 11.8748 18.8753 11.6872C19.7618 10.9727 20.5186 10.1108 21.1125 9.1394H23.5463C23.7735 9.1394 23.9577 8.95521 23.9577 8.728C23.9577 8.50079 23.7735 8.31661 23.5463 8.31661H21.4914C21.7713 7.5509 21.9099 6.74078 21.9007 5.92558C21.9007 2.57888 19.8631 0.500102 16.583 0.500102ZM2.97654 5.92558C2.97654 3.04335 4.65667 1.32289 7.47144 1.32289C9.21085 1.31738 10.816 2.25703 11.6627 3.77645C11.7407 3.90289 11.8787 3.97988 12.0272 3.97988C12.1758 3.97988 12.3137 3.90289 12.3917 3.77645C13.2384 2.25703 14.8436 1.31738 16.583 1.32289C19.3978 1.32289 21.0779 3.04335 21.0779 5.92558C21.0903 6.74763 20.9269 7.56283 20.5986 8.31661H18.1981C18.0312 8.31667 17.8809 8.4176 17.8176 8.57208L17.3593 6.96764C17.3085 6.79268 17.1486 6.67199 16.9664 6.67103H16.964C16.7822 6.67101 16.622 6.79026 16.5698 6.96435L15.7964 9.54297L14.8979 5.35086C14.858 5.16368 14.6942 5.0288 14.5028 5.02546C14.3114 5.02212 14.143 5.1512 14.0965 5.33687L13.3515 8.31661H11.2044C11.0375 8.31667 10.8872 8.4176 10.8239 8.57208L10.3656 6.96764C10.3148 6.79268 10.1549 6.67199 9.97272 6.67103C9.78748 6.66168 9.62143 6.78449 9.57613 6.96435L8.80271 9.54297L7.90422 5.35086C7.86423 5.1636 7.70033 5.02869 7.50887 5.02545C7.31639 5.01856 7.14607 5.14918 7.10283 5.33687L6.35779 8.31661H3.45581C3.12758 7.56283 2.96417 6.74763 2.97654 5.92558ZM18.3273 11.073C18.1101 11.2671 17.8987 11.4555 17.7008 11.6444C16.5188 12.772 13.0105 15.6292 12.0272 16.4264C11.044 15.6292 7.53603 12.772 6.35368 11.6444C6.1558 11.4555 5.94434 11.2671 5.72712 11.073C5.04169 10.5085 4.4313 9.85875 3.91081 9.1394H6.67909C6.86779 9.13939 7.03229 9.01101 7.07814 8.82797L7.47102 7.25644L8.33495 11.2824C8.37426 11.4661 8.53308 11.5999 8.72084 11.6074C8.90817 11.6131 9.07638 11.4933 9.13224 11.3144L9.96284 8.54616L10.3997 10.0753C10.4493 10.2488 10.6061 10.3697 10.7865 10.3736C10.965 10.3719 11.1239 10.2598 11.1855 10.0922L11.501 9.1394H13.6728C13.8615 9.13939 14.026 9.01101 14.0719 8.82797L14.4647 7.25644L15.3287 11.2824C15.368 11.4661 15.5268 11.5999 15.7146 11.6074H15.7298C15.9115 11.6074 16.0717 11.4881 16.1239 11.314L16.9545 8.54575L17.3914 10.0749C17.441 10.2484 17.5978 10.3693 17.7781 10.3732C17.9562 10.3698 18.1142 10.2584 18.1772 10.0918L18.4948 9.1394H20.1436C19.6231 9.85875 19.0128 10.5085 18.3273 11.073Z"
                        fill="currentColor"/>
                </svg>
            </Box>

            <Flex width={'10px'} height={'100%'}/>

            <Box color={risks.includes('TITUL') ? 'green' : 'lightGrey'}>
                <svg width="17" height="21" viewBox="0 0 17 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M16.6728 4.30521L9.17278 1.02221C9.04525 0.966555 8.9003 0.966555 8.77278 1.02221L1.27278 4.30521C1.09065 4.3847 0.972881 4.56449 0.972778 4.76321V12.6132C0.975489 14.3774 1.82323 16.0334 3.25278 17.0672L8.43628 20.8057C8.75642 21.0374 9.18914 21.0374 9.50928 20.8057L14.6928 17.0677C16.1223 16.0339 16.9701 14.3779 16.9728 12.6137V4.76321C16.9727 4.56449 16.8549 4.3847 16.6728 4.30521ZM15.9728 12.6137C15.9705 14.0567 15.2771 15.4112 14.1078 16.2567L8.97278 19.9602L3.83778 16.2567C2.6685 15.4112 1.97507 14.0567 1.97278 12.6137V5.09021L8.97278 2.02621L15.9728 5.09021V12.6137Z"
                        fill="currentColor"/>
                    <path
                        d="M8.77287 3.20507L3.27287 5.61307C3.09074 5.69256 2.97297 5.87235 2.97287 6.07107V12.6136C2.97441 13.7354 3.51361 14.7885 4.42287 15.4456L8.68037 18.5166C8.85502 18.6426 9.09072 18.6426 9.26537 18.5166L13.5229 15.4456C14.4321 14.7885 14.9713 13.7354 14.9729 12.6136V6.07107C14.9728 5.87235 14.855 5.69256 14.6729 5.61307L9.17287 3.20507C9.04535 3.14942 8.9004 3.14942 8.77287 3.20507ZM13.9729 6.39757V12.6136C13.9713 13.4141 13.5865 14.1655 12.9379 14.6346L8.97287 17.4946L5.00787 14.6346C4.3592 14.1655 3.9744 13.4141 3.97287 12.6136V6.39757L8.97287 4.20907L13.9729 6.39757Z"
                        fill="currentColor"/>
                    <path
                        d="M6.27287 11.5803C6.05195 11.4146 5.73855 11.4594 5.57287 11.6803C5.40718 11.9012 5.45195 12.2146 5.67287 12.3803L7.67287 13.8803C7.75942 13.9452 7.86468 13.9803 7.97287 13.9803C8.00118 13.9802 8.02943 13.9779 8.05737 13.9733C8.19278 13.9501 8.31267 13.8721 8.38887 13.7578L12.3889 7.75779C12.488 7.60917 12.5003 7.41894 12.4212 7.25877C12.3421 7.0986 12.1835 6.99282 12.0052 6.98127C11.8269 6.96973 11.656 7.05417 11.5569 7.20279L7.84987 12.7633L6.27287 11.5803Z"
                        fill="currentColor"/>
                </svg>
            </Box>
        </Flex>
    )
}